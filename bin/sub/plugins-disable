#!/usr/bin/env bash
# shellcheck disable=SC1090

set -o errexit
set -o nounset
set -o pipefail
[[ -n "${VERBOSE:+x}" ]] && set -o verbose
[[ -n "${DEBUG:-}" ]] && IS_DEBUG=true || IS_DEBUG=false

readonly SCRIPT_DIR="$(cd -P -- "$(dirname -- "$0")" && pwd -P)"
readonly PLUGINS_DIR=$SCRIPT_DIR/../../bash_it/plugins

# Provide sub completions
if [[ "${1:-}" == "--complete" ]]; then
  find "$PLUGINS_DIR/enabled/" -d 1 -type l -name '*---*.plugin.bash' -print0 \
    | xargs -0 -n1 -I{} basename '{}' .plugin.bash \
    | sed -E 's/^[[:digit:]]{3}---([-_a-zA-Z0-9]+)$/\1/'
  exit 0
fi


readonly args=("$@")

get_plugin_path() {
  local name=$1
  compgen -G "$PLUGINS_DIR/enabled/*---$name.plugin.bash" || true
}

disable_plugin() {
  local name=$1
  local filepath
  filepath=$(get_plugin_path "$name")

  if [[ -f "$filepath" ]]; then
    unlink "$filepath"
    echo "$name".plugin.bash disabled
  else
    echo "Warning: Not found enabled plugin '$name'" >&2
  fi
}

for name in "${args[@]}"; do
  disable_plugin "$name"
done
