#!/usr/bin/env bash

set -o errexit
set -o nounset
set -o pipefail
(shopt -p inherit_errexit &>/dev/null) && shopt -s inherit_errexit


readonly SCRIPT_DIR="$(cd -P -- "$(dirname -- "$0")" && pwd -P)"

readonly opt=${1:-}

if [[ "$opt" == '-h' ]]; then
cat <<EOF
$0    : List enabled plugins
$0 -a : List all plugins
EOF
  exit
fi

# @TODO sort names
if [[ "$opt" == '-a' ]]; then
  find "$SCRIPT_DIR"/../../bash_it/plugins/available/ -d 1 -type f -exec basename {} .plugin.bash \; | sort | tr '\n' ' '
else
  # @TODO trim name prefix
  find "$SCRIPT_DIR"/../../bash_it/plugins/enabled/ -d 1 -type l \
    -name '*---*.plugin.bash' \
    -exec basename {} .plugin.bash \; \
    | sed -E 's/^[[:digit:]]{3}---([-_a-zA-Z0-9]+)$/\1/' \
    | sort \
    | tr '\n' ' '
fi

echo ""
